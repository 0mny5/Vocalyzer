<p id="notice"><%= notice %></p>

<div class="container">
  <div id="select-project" class="row justify-content-center m-3">
    <%= form_with model: @project, url: select_projects_path, id: 'js-select-project' do |f| %>
      <span> Project: </span>
      <%= f.collection_select :id, current_user.projects, :id, :title %>
      <%= f.submit 'セット', class: "btn-secondary" %>
    <% end %>
  </div>
</div>

  <% if current_user.twitter? %>
    <%= link_to 'Twitter共有', "https://twitter.com/share?url=#{request.url}", title: 'Twitter', target: '_blank', id: "js-capture" %>
  <% end %>

<div class="container">
  <div class="row">
    <div class="col-1 my-3">
      <%= form_with model: @song, url: select_songs_path do |f| %>
        <%= f.collection_select :id, @project.songs, :id, :song_label, { selected: @song.id }, { :onchange => "selectSong($(this).val());" } %>
    <% end %>
    </div>
    <div class="col-8 my-3">
      <%= form_with model: @song, url: change_song_path(@song), id: "js-change-song" do |f| %>
        <%= f.hidden_field :currentid %>
        <%= f.text_field :url, id: 'target', class: "col-10" %>
        <%= f.submit '楽曲更新', class: 'mx-3' %>
      <% end %>
    </div>
  </div>
</div>

<div class="container">
  <div id="analyzer-1">
    <div class="sw-extra-stats-1 col-4 d-inline-block">
      <%= render 'shared/song_stats', class: 'col-6 my-3' %>
      <%= javascript_include_tag "sw-extra-stats-1.js" %>
    </div>
    <div class="songle-display col-6 float-right" data-api="songle-widget-extra-module-1" data-url="<%= @song.url %>" id="songle-widget">
    </div>
    <script src="https://widget.songle.jp/v1/widgets.js"></script>
  </div>
</div>

<div class="border-bottom border-dark" style="height: 30px;"></div>

<div class="analyzer-2">
  <iframe src="<%= users_project_analyze_path(@project) %>" frameBorder="0" height="400px" width="1260px"></iframe>
</div>

<p class="m-3">
<a class="btn btn-primary" data-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">
  検索フォームを表示
</a>
</p>
<div class="collapse" id="collapseExample">
  <div class="card card-body">
    <%= form_with url: search_songs_path, local: false do |f| %>
      <%= f.label '検索ワード' %>
      <%= f.text_field :word, id: 'js_search_word' %>
      <span><%= f.submit '検索', id: 'js-song-search' %></span>
    <% end %>
    <div id="search-field"></div>
  </div>
</div>

<script>
  function selectSong(val){
      var song_id = val;
      $('#song_currentid').val(song_id);

      $.ajax({
          url: "/select_songs",
          type: "GET",
          data: {
              song_id: song_id
            }
        })
    }
</script>
